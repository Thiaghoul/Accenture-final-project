# Story 2.4: User Edits Task Details

## Status
Draft

## Story
**As a** project member,
**I want** to view and edit the details of a task,
**so that** I can keep the task information up-to-date.

## Acceptance Criteria
1. An authorized user (project member with 'Editor' or 'Manager' role) can update a task's title, description, assignee, priority, due date, and completion percentage.
2. An `ActivityLog` entry is created for each significant change (e.g., assignee changed, due date updated).
3. The API returns the updated task details upon success.
4. Users with 'Viewer' role are not permitted to edit tasks.
5. Users who are not members of the board are not permitted to edit tasks.

## Tasks / Subtasks
- [ ] Create `UpdateCardRequest` DTO with all editable fields for a task.
- [ ] Implement an `updateCard` method in `CardService`. (AC: 1, 2, 4, 5)
  - [ ] Verify the user has the required role ('Editor' or 'Manager') for the board.
  - [ ] Find the existing card by its ID.
  - [ ] Compare the incoming data with the existing data to identify changes.
  - [ ] For each change, create an `ActivityLog` entry (e.g., `ASSIGNEE_CHANGED`).
  - [ ] Update the card entity and save it.
  - [ ] Map the updated entity to `CardResponse`.
- [ ] Implement a `PUT /tasks/{taskId}` endpoint in `CardController`. (AC: 1, 3, 4, 5)
  - [ ] Secure the endpoint with JWT authentication.
  - [ ] Call `CardService.updateCard`.
  - [ ] Return the updated `CardResponse`.
- [ ] Write unit tests for `CardService`'s `updateCard` method, covering authorization, change detection, and activity logging.
- [ ] Write integration tests for the `PUT /tasks/{taskId}` endpoint.

## Dev Notes
### Data Models
- **Card (Task):** The existing `CardsModels` entity will be updated.
- **ActivityLog:** New entries will be created to track changes. The `eventType` enum may need new values like `TITLE_CHANGED`, `DESCRIPTION_CHANGED`, etc.
- [Source: architecture.md#4.5.-Card-(Task), architecture.md#4.7.-ActivityLog]

### API Specifications
- **Endpoint:** `PUT /tasks/{taskId}`
- **Security:** Requires JWT `bearerAuth`. Role-based authorization ('Editor', 'Manager') must be enforced at the service level.
- **Path Parameters:** `taskId` (UUID).
- **Request Body:** `UpdateCardRequest` DTO.
- **Responses:** 200 OK (returns updated `CardResponse`), 403 Forbidden, 404 Not Found.

### Component Specifications
- **Task Management Component:** The `CardService` will be extended with the update logic.
- [Source: architecture.md#5.4.-Task-Management-Component]

### File Locations (based on Source Tree)
- **DTO:** `backend/src/main/java/com/grupo5/taskflow/dto/UpdateCardRequest.java`
- **Service:** `backend/src/main/java/com/grupo5/taskflow/service/CardService.java` (updated)
- **Controller:** `backend/src/main/java/com/grupo5/taskflow/controller/CardController.java` (updated)
- [Source: architecture.md#10.-Source-Tree]

### Testing
- **Unit Tests:** Update `CardServiceTest.java`.
- **Integration Tests:** Update `CardControllerIntegrationTest.java`.
- [Source: architecture.md#14.-Test-Strategy-and-Standards]

## Change Log
| Date | Version | Description | Author |
| :--- | :------ | :---------- | :----- |
| 2025-11-05 | 1.0 | Initial draft of story 2.4 | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List

## QA Results
