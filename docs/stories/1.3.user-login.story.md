# Story 1.3: User Login & JWT Generation

## Status
Draft

## Story
**As a** returning user,
**I want** to log in with my credentials,
**so that** I can receive a JWT to access protected resources.

## Acceptance Criteria
1. A registered user can send a POST request with their email and password to a `/auth/login` endpoint.
2. If the credentials are valid, the server returns a valid JWT.
3. If the credentials are invalid, the server returns an authentication error.
4. The returned JWT can be successfully used to authenticate against a protected test endpoint.

## Tasks / Subtasks
- [ ] Create `LoginRequest` DTO. (AC: 1)
- [ ] Create `LoginResponse` DTO to hold the JWT. (AC: 2)
- [ ] Implement a `JwtService` to handle JWT creation and validation. (AC: 2, 4)
- [ ] Implement a `login` method in `AuthService`. (AC: 2, 3)
  - [ ] Use Spring Security's `AuthenticationManager` to validate credentials.
  - [ ] If authentication is successful, call `JwtService` to generate a token.
- [ ] Implement a `POST /auth/login` endpoint in `AuthController`. (AC: 1)
- [ ] Configure Spring Security (`SecurityConfig`) to handle the login process and define which endpoints are protected. (AC: 4)
  - [ ] Expose `/auth/login` and `/auth/register` as public endpoints.
  - [ ] Secure all other endpoints by default.
  - [ ] Add a `JwtTokenFilter` to the security chain to validate tokens on incoming requests.
- [ ] Create a simple protected endpoint (e.g., `GET /api/test/hello`) for testing JWT authentication. (AC: 4)
- [ ] Write unit tests for `AuthService`'s `login` method and `JwtService`.
- [ ] Write integration tests for the `POST /auth/login` endpoint and the protected test endpoint.

## Dev Notes
### API Specifications
- **Endpoint:** `POST /auth/login`
- **Request Body:** `LoginRequest` schema.
- **Responses:** 200 OK (returns `LoginResponse` with JWT), 401 Unauthorized.
- [Source: architecture.md#8.-REST-API-Spec]

### Component Specifications
- **Authentication Component:** `AuthService` will handle the login logic. A new `JwtService` will be created for token management. The Spring Security filter chain is a key part of this component.
- [Source: architecture.md#5.1.-Authentication-Component]

### File Locations (based on Source Tree)
- **DTOs:** `.../dto/LoginRequest.java`, `.../dto/LoginResponse.java`
- **Service:** `.../service/AuthService.java`, `.../service/JwtService.java`
- **Controller:** `.../controller/AuthController.java`
- **Security:** `.../security/JwtTokenFilter.java`, `.../config/SecurityConfig.java`
- [Source: architecture.md#10.-Source-Tree]

### Security
- JWTs are the core of the session management. Ensure they are created with a strong secret key and have a reasonable expiration time.
- The `JwtTokenFilter` is critical for securing endpoints.
- [Source: architecture.md#15.2.-Authentication-&-Authorization]

## Change Log
| Date | Version | Description | Author |
| :--- | :------ | :---------- | :----- |
| 2025-11-05 | 1.0 | Initial draft of story 1.3 | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List

## QA Results
