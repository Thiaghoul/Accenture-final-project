# Story 3.1: Project Manager Invites User to Board

## Status
Draft

## Story
**As a** Project Manager,
**I want** to invite other users to a project by their email address,
**so that** I can build my team and grant them access to the board.

## Acceptance Criteria
1. A Project Manager can invite an existing user to a board they manage.
2. The invited user is added to the board with a default role (e.g., 'Viewer').
3. An `ActivityLog` entry is created on the board to record the `BOARD_MEMBER_ADDED` event.
4. The API returns a success message or the updated list of board members.
5. A user cannot be added to the same board more than once.
6. Only Project Managers of the board can invite new members.

## Tasks / Subtasks
- [ ] Create `InviteUserRequest` DTO containing `userEmail`.
- [ ] Implement an `inviteUserToBoard` method in `BoardService`. (AC: 1, 2, 3, 5, 6)
  - [ ] Verify the authenticated user is a 'Manager' for the specified board.
  - [ ] Find the user to be invited by their email.
  - [ ] Check if the user is already a member of the board.
  - [ ] Create a new `BoardMember` entity with the user's ID, board ID, and a default role.
  - [ ] Save the new `BoardMember` entity.
  - [ ] Create a board-level `ActivityLog` entry.
- [ ] Implement a `POST /projects/{boardId}/members` endpoint in `BoardController`. (AC: 1, 4, 6)
  - [ ] Secure the endpoint with JWT authentication.
  - [ ] Call `BoardService.inviteUserToBoard`.
- [ ] Write unit tests for `BoardService`'s `inviteUserToBoard` method.
- [ ] Write integration tests for the `POST /projects/{boardId}/members` endpoint.

## Dev Notes
### Data Models
- **BoardMember:** A new record will be created in the `board_members` join table to link a `User` to a `Board`.
- **ActivityLog:** A new entry will be created with `eventType: BOARD_MEMBER_ADDED`. The `boardId` field will be populated.
- [Source: architecture.md#4.8.-BoardMember-(Join-Table-for-Board-and-User), architecture.md#4.7.-ActivityLog]

### API Specifications
- **Endpoint:** `POST /projects/{boardId}/members`
- **Security:** Requires JWT `bearerAuth`. Authorization logic must ensure the caller is a 'Manager' of the board.
- **Path Parameters:** `boardId` (UUID).
- **Request Body:** `InviteUserRequest` DTO with `userEmail`.
- **Responses:** 200 OK (with success message or new member list), 400 Bad Request (user already a member), 403 Forbidden, 404 Not Found (user or board not found).

### Component Specifications
- **Project Management Component:** The `BoardService` will be extended to handle the invitation logic.
- [Source: architecture.md#5.3.-Project-Management-Component]

### File Locations (based on Source Tree)
- **DTO:** `backend/src/main/java/com/grupo5/taskflow/dto/InviteUserRequest.java`
- **Service:** `backend/src/main/java/com/grupo5/taskflow/service/BoardService.java` (updated)
- **Controller:** `backend/src/main/java/com/grupo5/taskflow/controller/BoardController.java` (updated)
- [Source: architecture.md#10.-Source-Tree]

### Testing
- **Unit Tests:** Update `BoardServiceTest.java`.
- **Integration Tests:** Update `BoardControllerIntegrationTest.java`.
- [Source: architecture.md#14.-Test-Strategy-and-Standards]

## Change Log
| Date | Version | Description | Author |
| :--- | :------ | :---------- | :----- |
| 2025-11-05 | 1.0 | Initial draft of story 3.1 | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List

## QA Results
