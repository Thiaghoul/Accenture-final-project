# Story 3.4: User Adds Comment to Task

## Status
Draft

## Story
**As a** project member,
**I want** to add comments to a task,
**so that** I can discuss the task with my team and provide updates.

## Acceptance Criteria
1. An authorized user (any member of the board) can add a text comment to a task on that board.
2. A new `Comment` entity is created and linked to the task and the user who posted it.
3. An `ActivityLog` entry is created with `eventType: COMMENT_ADDED`.
4. The API returns the newly created comment.
5. Users who are not members of the board cannot add comments.

## Tasks / Subtasks
- [ ] Create `AddCommentRequest` DTO containing `content` (the comment text).
- [ ] Create `CommentResponse` DTO to return comment details (id, content, author, timestamp).
- [ ] Implement an `addComment` method in a new `CommentService`. (AC: 1, 2, 3, 5)
  - [ ] Verify the user is a member of the board where the task resides.
  - [ ] Create and save a new `CommentsModels` entity.
  - [ ] Trigger `ActivityLogService` to record the `COMMENT_ADDED` event.
- [ ] Implement a `POST /tasks/{taskId}/comments` endpoint in a new `CommentController`. (AC: 1, 4, 5)
  - [ ] Secure the endpoint with JWT authentication.
  - [ ] Call `CommentService.addComment`.
- [ ] Write unit tests for `CommentService`.
- [ ] Write integration tests for the `POST /tasks/{taskId}/comments` endpoint.

## Dev Notes
### Data Models
- **Comment:** A new `CommentsModels` entity will be created. Key attributes: `id`, `cardId`, `userId`, `content`, `createdAt`.
- **ActivityLog:** A new entry will be created with `eventType: COMMENT_ADDED`.
- [Source: architecture.md#4.6.-Comment, architecture.md#4.7.-ActivityLog]

### API Specifications
- **Endpoint:** `POST /tasks/{taskId}/comments`
- **Security:** Requires JWT `bearerAuth`. User must be a member of the board.
- **Path Parameters:** `taskId` (UUID).
- **Request Body:** `AddCommentRequest` DTO with `content`.
- **Responses:** 201 Created (returns `CommentResponse`), 403 Forbidden, 404 Not Found.

### Component Specifications
- **Task Management Component:** A new `CommentService` and `CommentRepository` will be created to handle comment logic.
- [Source: architecture.md#5.4.-Task-Management-Component]

### File Locations (based on Source Tree)
- **DTOs:**
  - `backend/src/main/java/com/grupo5/taskflow/dto/AddCommentRequest.java`
  - `backend/src/main/java/com/grupo5/taskflow/dto/CommentResponse.java`
- **Model:** `backend/src/main/java/com/grupo5/taskflow/model/CommentsModels.java`
- **Repository:** `backend/src/main/java/com/grupo5/taskflow/repository/CommentRepository.java`
- **Service:** `backend/src/main/java/com/grupo5/taskflow/service/CommentService.java`
- **Controller:** `backend/src/main/java/com/grupo5/taskflow/controller/CommentController.java`
- [Source: architecture.md#10.-Source-Tree]

### Testing
- **Unit Tests:** Create `CommentServiceTest.java`.
- **Integration Tests:** Create `CommentControllerIntegrationTest.java`.
- [Source: architecture.md#14.-Test-Strategy-and-Standards]

## Change Log
| Date | Version | Description | Author |
| :--- | :------ | :---------- | :----- |
| 2025-11-05 | 1.0 | Initial draft of story 3.4 | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List

## QA Results
