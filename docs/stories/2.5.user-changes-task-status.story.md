# Story 2.5: User Changes Task Status

## Status
Draft

## Story
**As a** project member,
**I want** to change a task's status by moving it to a different column,
**so that** I can reflect the progress of my work on the Kanban board.

## Acceptance Criteria
1. An authorized user (project member with 'Editor' or 'Manager' role) can move a task from one column to another within the same board.
2. Moving a task updates the task's `columnId` to the new column's ID.
3. An `ActivityLog` entry is created with `eventType: STATUS_CHANGED`, detailing the old and new columns (statuses).
4. The API returns the updated task details, reflecting the new column.
5. The operation is atomic; both the task update and the activity log creation must succeed or fail together.

## Tasks / Subtasks
- [ ] Create `MoveCardRequest` DTO containing the `newColumnId`.
- [ ] Implement a `moveCard` method in `CardService`. (AC: 1, 2, 3, 5)
  - [ ] Verify the user has the required role ('Editor' or 'Manager').
  - [ ] Validate that the new column belongs to the same board as the task.
  - [ ] Update the `columnId` on the `CardsModels` entity.
  - [ ] Create an `ActivityLog` entry for the `STATUS_CHANGED` event.
  - [ ] Use `@Transactional` to ensure atomicity.
- [ ] Implement a `POST /tasks/{taskId}/move` endpoint in `CardController`. (AC: 1, 4)
  - [ ] Secure the endpoint with JWT authentication.
  - [ ] Call `CardService.moveCard`.
  - [ ] Return the updated `CardResponse`.
- [ ] Write unit tests for `CardService`'s `moveCard` method.
- [ ] Write integration tests for the `POST /tasks/{taskId}/move` endpoint.

## Dev Notes
### Data Models
- **Card (Task):** The `columnId` field of an existing `CardsModels` entity will be updated.
- **ActivityLog:** A `STATUS_CHANGED` entry will be created.
- [Source: architecture.md#4.5.-Card-(Task), architecture.md#4.7.-ActivityLog]

### API Specifications
- **Endpoint:** `POST /tasks/{taskId}/move`
- **Security:** Requires JWT `bearerAuth`. Role-based authorization ('Editor', 'Manager') is required.
- **Path Parameters:** `taskId` (UUID).
- **Request Body:** `MoveCardRequest` DTO with `newColumnId`.
- **Responses:** 200 OK (returns updated `CardResponse`), 400 Bad Request (e.g., new column is on a different board), 403 Forbidden, 404 Not Found.

### Component Specifications
- **Task Management Component:** The `CardService` will be extended with the move logic.
- [Source: architecture.md#5.4.-Task-Management-Component]

### File Locations (based on Source Tree)
- **DTO:** `backend/src/main/java/com/grupo5/taskflow/dto/MoveCardRequest.java`
- **Service:** `backend/src/main/java/com/grupo5/taskflow/service/CardService.java` (updated)
- **Controller:** `backend/src/main/java/com/grupo5/taskflow/controller/CardController.java` (updated)
- [Source: architecture.md#10.-Source-Tree]

### Testing
- **Unit Tests:** Update `CardServiceTest.java`.
- **Integration Tests:** Update `CardControllerIntegrationTest.java`.
- [Source: architecture.md#14.-Test-Strategy-and-Standards]

## Change Log
| Date | Version | Description | Author |
| :--- | :------ | :---------- | :----- |
| 2025-11-05 | 1.0 | Initial draft of story 2.5 | Bob (Scrum Master) |

## Dev Agent Record
### Agent Model Used
{{agent_model_name_version}}

### Debug Log References

### Completion Notes List

### File List

## QA Results
